<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="utf-8">
    <title>Lumina Sheets – Login</title>
    <style>
      :root {
        color-scheme: light;
        --primary: #00aeef;
        --primary-dark: #003f87;
        --navy: #003177;
        --surface: rgba(255, 255, 255, 0.92);
        --surface-border: rgba(0, 49, 119, 0.12);
        --text-primary: #1e293b;
        --text-muted: #64748b;
        --shadow: 0 20px 45px -25px rgba(0, 49, 119, 0.65);
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, rgba(0, 63, 135, 0.85), rgba(0, 174, 239, 0.85));
        position: relative;
        overflow: hidden;
      }
      body::before {
        content: '';
        position: absolute;
        inset: 0;
        background:
          radial-gradient(circle at 15% 20%, rgba(255, 255, 255, 0.2), transparent 55%),
          radial-gradient(circle at 80% 30%, rgba(255, 255, 255, 0.15), transparent 60%);
        pointer-events: none;
      }
      .card {
        position: relative;
        background: var(--surface);
        border: 1px solid var(--surface-border);
        border-radius: 24px;
        padding: 36px;
        width: min(400px, 92vw);
        box-shadow: var(--shadow);
        backdrop-filter: blur(16px);
        color: var(--text-primary);
      }
      h1 {
        font-size: 1.75rem;
        margin: 0 0 10px;
        font-weight: 700;
        color: var(--navy);
      }
      p {
        margin: 0 0 28px;
        color: var(--text-muted);
      }
      label {
        display: block;
        margin-bottom: 18px;
        color: var(--text-primary);
        font-weight: 600;
      }
      input[type="text"],
      input[type="password"] {
        width: 100%;
        padding: 14px 16px;
        border-radius: 14px;
        border: 1px solid rgba(100, 116, 139, 0.2);
        background: #ffffff;
        color: var(--text-primary);
        font-size: 1rem;
        font-weight: 500;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }
      input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(0, 174, 239, 0.2);
      }
      button {
        width: 100%;
        padding: 13px 18px;
        border-radius: 14px;
        border: none;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 120ms ease, box-shadow 120ms ease;
        box-shadow: 0 12px 26px -18px rgba(0, 49, 119, 0.75);
      }
      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 16px 28px -14px rgba(0, 63, 135, 0.65);
      }
      .actions {
        margin-top: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: var(--text-muted);
        font-size: 0.85rem;
      }
      .error {
        margin: 0 0 16px;
        color: #dc2626;
        font-weight: 600;
      }
      a {
        color: var(--primary-dark);
        font-weight: 600;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      .support-link:hover {
        color: var(--navy);
      }
    </style>
  </head>
  <body>
    <section class="card">
      <h1>Welcome back</h1>
      <p>Sign in to access the rebuilt Lumina Sheets workspace.</p>
      <div id="error" class="error" hidden></div>
      <form id="login-form">
        <label>
          <span>Email or username</span>
          <input type="text" name="identity" autocomplete="username" required />
        </label>
        <label>
          <span>Password</span>
          <input type="password" name="password" autocomplete="current-password" required />
        </label>
        <div class="actions">
          <label style="display:flex;align-items:center;gap:8px;">
            <input type="checkbox" name="remember" style="width:16px;height:16px;margin:0;" />
            <span>Remember this device</span>
          </label>
            <a href="#" class="support-link">Need help?</a>
        </div>
        <div style="margin-top:24px;">
          <button type="submit" id="submit">Sign in</button>
        </div>
      </form>
    </section>
    <script>
      const form = document.getElementById('login-form');
      const errorBox = document.getElementById('error');
      const submitBtn = document.getElementById('submit');

      function showError(message) {
        errorBox.textContent = message;
        errorBox.hidden = !message;
      }

      function setLoading(state) {
        submitBtn.disabled = state;
        submitBtn.textContent = state ? 'Signing in…' : 'Sign in';
      }

      form.addEventListener('submit', function (event) {
        event.preventDefault();
        showError('');
        setLoading(true);

        const data = Object.fromEntries(new FormData(form).entries());
        data.remember = form.remember.checked;

        google.script.run
          .withSuccessHandler(function (result) {
            setLoading(false);
            if (!result || !result.token) {
              showError('Unexpected response from server.');
              return;
            }
            localStorage.setItem('lumina::token', result.token);
            localStorage.setItem('lumina::user', JSON.stringify(result.user));
            window.location.href = '?page=dashboard';
          })
          .withFailureHandler(function (err) {
            setLoading(false);
            showError(err && err.message ? err.message : 'Unable to sign in.');
          })
          .appLogin(data);
      });
    </script>
  </body>
</html>
